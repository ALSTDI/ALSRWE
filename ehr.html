<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.47">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Electronic Health Records</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="ehr_files/libs/clipboard/clipboard.min.js"></script>
<script src="ehr_files/libs/quarto-html/quarto.js"></script>
<script src="ehr_files/libs/quarto-html/popper.min.js"></script>
<script src="ehr_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="ehr_files/libs/quarto-html/anchor.min.js"></script>
<link href="ehr_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="ehr_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="ehr_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="ehr_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="ehr_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


<link rel="stylesheet" href="styles.css">
</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#research-using-electronic-health-records" id="toc-research-using-electronic-health-records" class="nav-link active" data-scroll-target="#research-using-electronic-health-records"><span class="header-section-number">1</span> Research Using Electronic Health Records</a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction"><span class="header-section-number">2</span> Introduction</a>
  <ul class="collapse">
  <li><a href="#history-of-ehr-data" id="toc-history-of-ehr-data" class="nav-link" data-scroll-target="#history-of-ehr-data"><span class="header-section-number">2.1</span> History of EHR Data</a></li>
  <li><a href="#definitions" id="toc-definitions" class="nav-link" data-scroll-target="#definitions"><span class="header-section-number">2.2</span> Definitions</a></li>
  <li><a href="#extracting-ehr-data" id="toc-extracting-ehr-data" class="nav-link" data-scroll-target="#extracting-ehr-data"><span class="header-section-number">2.3</span> Extracting EHR Data</a>
  <ul class="collapse">
  <li><a href="#pros-and-cons-of-different-data-extraction-processes" id="toc-pros-and-cons-of-different-data-extraction-processes" class="nav-link" data-scroll-target="#pros-and-cons-of-different-data-extraction-processes"><span class="header-section-number">2.3.1</span> Pros and Cons of Different Data Extraction Processes</a></li>
  <li><a href="#common-data-models" id="toc-common-data-models" class="nav-link" data-scroll-target="#common-data-models"><span class="header-section-number">2.3.2</span> Common Data Models</a></li>
  <li><a href="#data-standards-common-data-elements-and-validated-instruments" id="toc-data-standards-common-data-elements-and-validated-instruments" class="nav-link" data-scroll-target="#data-standards-common-data-elements-and-validated-instruments"><span class="header-section-number">2.3.3</span> Data Standards, Common Data Elements, and Validated Instruments</a></li>
  <li><a href="#integrating-cdisc-cdes-and-validated-instruments-in-ehr-data-for-research" id="toc-integrating-cdisc-cdes-and-validated-instruments-in-ehr-data-for-research" class="nav-link" data-scroll-target="#integrating-cdisc-cdes-and-validated-instruments-in-ehr-data-for-research"><span class="header-section-number">2.3.4</span> Integrating CDISC, CDEs, and Validated Instruments in EHR Data for Research</a></li>
  </ul></li>
  <li><a href="#resources-and-must-readpapers" id="toc-resources-and-must-readpapers" class="nav-link" data-scroll-target="#resources-and-must-readpapers"><span class="header-section-number">2.4</span> Resources and “MUST READ”papers:</a>
  <ul class="collapse">
  <li><a href="#ebmonfhir-based-tools-and-initiatives-to-support-clinical-research" id="toc-ebmonfhir-based-tools-and-initiatives-to-support-clinical-research" class="nav-link" data-scroll-target="#ebmonfhir-based-tools-and-initiatives-to-support-clinical-research"><span class="header-section-number">2.4.1</span> EBMonFHIR-based tools and initiatives to support clinical research</a></li>
  <li><a href="#hl7-fhir-based-tools-and-initiatives-to-support-clinical-research-a-scoping-review" id="toc-hl7-fhir-based-tools-and-initiatives-to-support-clinical-research-a-scoping-review" class="nav-link" data-scroll-target="#hl7-fhir-based-tools-and-initiatives-to-support-clinical-research-a-scoping-review"><span class="header-section-number">2.4.2</span> HL7 FHIR-based tools and initiatives to support clinical research: a scoping review</a></li>
  <li><a href="#technology-enabled-clinical-trials-transforming-medical-evidence-generation" id="toc-technology-enabled-clinical-trials-transforming-medical-evidence-generation" class="nav-link" data-scroll-target="#technology-enabled-clinical-trials-transforming-medical-evidence-generation"><span class="header-section-number">2.4.3</span> Technology-Enabled Clinical Trials: Transforming Medical Evidence Generation</a></li>
  <li><a href="#for-more-information-on-hl7-cda-and-fhir-standards-and-on-extracting-ehr-data-you-can-visit-the-following-websites" id="toc-for-more-information-on-hl7-cda-and-fhir-standards-and-on-extracting-ehr-data-you-can-visit-the-following-websites" class="nav-link" data-scroll-target="#for-more-information-on-hl7-cda-and-fhir-standards-and-on-extracting-ehr-data-you-can-visit-the-following-websites"><span class="header-section-number">2.4.4</span> For more information on HL7, CDA, and FHIR standards, and on extracting EHR data, you can visit the following websites:</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Electronic Health Records</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="research-using-electronic-health-records" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Research Using Electronic Health Records</h1>
</section>
<section id="introduction" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Introduction</h1>
<p>Electronic Health Records (EHR) have revolutionized the way healthcare information is stored, accessed, and used across the medical industry. This primer aims to provide a lay audience with an understanding of EHR data, its history, key definitions, and insights into the standards and methodologies for extracting EHR data for research. We’ll explore HL7, CDA, and FHIR standards, the differences between direct EHR data extraction and using OAuth 2.0, and review common data models along with the pros and cons of various data extraction processes.</p>
<section id="history-of-ehr-data" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="history-of-ehr-data"><span class="header-section-number">2.1</span> History of EHR Data</h2>
<p>EHR data’s history dates back to the 1960s with the earliest systems focusing on simple data capture and storage. Over the decades, EHR systems have evolved significantly, incorporating more complex data types such as imaging and laboratory results, and enabling more sophisticated data sharing and interoperability. The goal has always been to improve patient care, streamline healthcare operations, and facilitate health research. EHR data vendors include Epic and Cerner.</p>
</section>
<section id="definitions" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="definitions"><span class="header-section-number">2.2</span> Definitions</h2>
<ul>
<li><p><strong>EHR (Electronic Health Record):</strong> A digital version of a patient’s paper chart. EHRs contain the patient’s medical history, diagnoses, medications, treatment plans, immunization dates, allergies, radiology images, and laboratory test results. EHRs are designed to be shared with other providers across more than one healthcare organization to provide accurate, up-to-date, and complete information about patients at the point of care.</p></li>
<li><p><strong>HL7 (Health Level Seven International):</strong> A set of international standards for the exchange, integration, sharing, and retrieval of electronic health information. HL7 standards support clinical practice and the management, delivery, and evaluation of health services.</p></li>
<li><p><strong>CDA (Clinical Document Architecture):</strong> An HL7 standard designed to allow healthcare providers to exchange clinical documents, such as discharge summaries and progress notes, in a readable and structured format.</p></li>
<li><p><strong>FHIR (Fast Healthcare Interoperability Resources):</strong> The latest standard by HL7, designed to enable healthcare information to be available, discoverable, and understandable globally, and to support a wide range of applications, including mobile apps, cloud communications, and data analysis algorithms. For a comprehensive understanding of Fast Healthcare Interoperability Resources (FHIR) concepts and data models, refer to the <a href="https://learn.microsoft.com/en-us/training/modules/health-data-fast-healthcare-interoperability-resources/concepts-data-model">Microsoft Learn documentation on FHIR</a>. From this training, “US Core provides the framework for the implementation of regulations that are driven by the Centers for Medicare &amp; Medicaid Services (CMS) and the ONC Final Rule [https://www.healthit.gov/topic/oncs-cures-act-final-rule]. Payors and providers across the United States who accept Medicare/Medicaid patients implement FHIR® by following the profiles that are defined in US Core.</p></li>
<li><p><strong>OAuth 2.0:</strong> An authorization framework that enables applications to obtain limited access to user accounts on an HTTP service, such as Facebook, GitHub, and digital health records. NIH’s All of Us Study uses OAuth 2.0 via <a href="https://www.healthit.gov/topic/sync-science">Sync for Science</a>.</p></li>
<li><p><strong>APIs</strong> An API, or Application Programming Interface, is a set of rules, protocols, and tools for building software and applications. It specifies how software components should interact and allows different software applications to communicate with each other. APIs play a crucial role in enabling the integration of systems, services, and applications by providing a predefined way for accessing a set of functions or data.</p></li>
</ul>
<p>In web development, APIs are often used to enable the interaction between different web services. For example, a weather service might provide an API that allows developers to integrate weather data into their own websites or applications. Similarly, social media platforms offer APIs that enable developers to create apps that can post updates, access user data (with permission), or analyze trends based on the platform’s data.</p>
<p>APIs can be categorized into different types, including:</p>
<ul>
<li><p><strong>Web APIs:</strong> These are designed for both the web server and web browser. They include REST (Representational State Transfer), SOAP (Simple Object Access Protocol), and GraphQL APIs, among others, and are used for web services communication.</p></li>
<li><p><strong>Operating System APIs:</strong> These provide functions for managing and controlling computer hardware and basic system operations. They allow developers to write applications compatible with the operating system.</p></li>
<li><p><strong>Database APIs:</strong> These allow communication between an application and a database management system. Developers can use these APIs to create, read, update, and delete database entries.</p></li>
<li><p><strong>Remote APIs:</strong> These are used for communication between software on different machines across a network, enabling distributed computing.</p></li>
</ul>
</section>
<section id="extracting-ehr-data" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="extracting-ehr-data"><span class="header-section-number">2.3</span> Extracting EHR Data</h2>
<p>Extracting EHR data can be done directly from the EHR system at a healthcare site or via web-based APIs using protocols like OAuth 2.0. Direct extraction involves accessing the EHR database or data warehouse, often requiring custom queries and significant IT support. OAuth 2.0, meanwhile, allows researchers to access data through predefined APIs with the user’s consent, facilitating more standardized and scalable data access.</p>
<p>When it comes to extracting EHR data for clinical research, the devil is in the details. Do not assume that all approaches can extract 100% of the relevant information or records. Some information is either a) not reoutinely collected in EHR or b) not available through the extraction approach selected.</p>
<section id="pros-and-cons-of-different-data-extraction-processes" class="level3" data-number="2.3.1">
<h3 data-number="2.3.1" class="anchored" data-anchor-id="pros-and-cons-of-different-data-extraction-processes"><span class="header-section-number">2.3.1</span> Pros and Cons of Different Data Extraction Processes</h3>
<section id="direct-extraction" class="level4" data-number="2.3.1.1">
<h4 data-number="2.3.1.1" class="anchored" data-anchor-id="direct-extraction"><span class="header-section-number">2.3.1.1</span> Direct Extraction:</h4>
<ul>
<li><strong>Pros:</strong> Can access comprehensive EHR data; allows for custom queries.</li>
<li><strong>Cons:</strong> Requires significant IT resources; potential privacy and security concerns; may be time-consuming.</li>
</ul>
</section>
<section id="oauth-2.0api-based-extraction" class="level4" data-number="2.3.1.2">
<h4 data-number="2.3.1.2" class="anchored" data-anchor-id="oauth-2.0api-based-extraction"><span class="header-section-number">2.3.1.2</span> OAuth 2.0/API-Based Extraction:</h4>
<ul>
<li><strong>Pros:</strong> Standardized access method; scalable; less IT-intensive; enhances data security .</li>
<li><strong>Cons:</strong> May offer limited access to EHR data; dependent on the availability and functionality of APIs.</li>
</ul>
<table class="caption-top table">
<colgroup>
<col style="width: 22%">
<col style="width: 38%">
<col style="width: 38%">
</colgroup>
<thead>
<tr class="header">
<th>Extraction Method</th>
<th>Pros</th>
<th>Cons</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>OAuth/API-based</td>
<td>Standardized access; scalable; less IT-intensive; enhances security by limiting access</td>
<td>May offer limited access to data; dependent on API functionality</td>
</tr>
<tr class="even">
<td>Direct Extraction</td>
<td>Access to comprehensive EHR data; allows for custom queries</td>
<td>Requires significant IT resources; potential privacy concerns</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="common-data-models" class="level3" data-number="2.3.2">
<h3 data-number="2.3.2" class="anchored" data-anchor-id="common-data-models"><span class="header-section-number">2.3.2</span> Common Data Models</h3>
<p>Common Data Models (CDMs) standardize the format and terminology of healthcare data from various sources, making it easier to aggregate, share, and analyze data across different systems. Examples include the Observational Medical Outcomes Partnership (OMOP) and the Patient-Centered Outcomes Research Network (PCORnet).</p>
</section>
<section id="data-standards-common-data-elements-and-validated-instruments" class="level3" data-number="2.3.3">
<h3 data-number="2.3.3" class="anchored" data-anchor-id="data-standards-common-data-elements-and-validated-instruments"><span class="header-section-number">2.3.3</span> Data Standards, Common Data Elements, and Validated Instruments</h3>
<p><strong>CDISC:</strong> Clinical Data Interchange Standards Consortium. The Clinical Data Interchange Standards Consortium (CDISC) is a global non-profit organization that develops and supports global data standards to improve the quality and efficiency of clinical research. CDISC standards are designed to facilitate the harmonization of clinical data and streamline research processes from protocol through analysis and reporting. This standardization supports the direct use of EHR data for research and regulatory submissions, making it easier to compare and combine data from different studies or sources.</p>
<section id="common-data-elements-cdes" class="level4" data-number="2.3.3.1">
<h4 data-number="2.3.3.1" class="anchored" data-anchor-id="common-data-elements-cdes"><span class="header-section-number">2.3.3.1</span> Common Data Elements (CDEs)</h4>
<p>Common Data Elements (CDEs) are precisely defined questions and answer choices, along with associated metadata, used in clinical research and patient care. They are intended to promote the collection of standardized data across studies and health records. By standardizing the way data is collected, stored, and exchanged, CDEs enable researchers to more easily compare and combine data from different sources, enhancing data quality and research efficiency.</p>
</section>
<section id="validated-instruments" class="level4" data-number="2.3.3.2">
<h4 data-number="2.3.3.2" class="anchored" data-anchor-id="validated-instruments"><span class="header-section-number">2.3.3.2</span> Validated Instruments</h4>
<p>Validated instruments are tools or questionnaires that have been scientifically proven to accurately and reliably measure a specific concept or construct, such as symptoms, quality of life, or functional status. Validation involves rigorous testing to ensure the instrument consistently produces accurate data that reflects what it is designed to measure across different populationsand settings.</p>
</section>
</section>
<section id="integrating-cdisc-cdes-and-validated-instruments-in-ehr-data-for-research" class="level3" data-number="2.3.4">
<h3 data-number="2.3.4" class="anchored" data-anchor-id="integrating-cdisc-cdes-and-validated-instruments-in-ehr-data-for-research"><span class="header-section-number">2.3.4</span> Integrating CDISC, CDEs, and Validated Instruments in EHR Data for Research</h3>
<p>The integration of CDISC standards, CDEs, and validated instruments into EHR systems and research protocols can significantly enhance the quality, efficiency, and comparability of health data. This integration supports streamlined data collection and analysis, regulatory compliance and submission, and enhanced interoperability.</p>
</section>
</section>
<section id="resources-and-must-readpapers" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="resources-and-must-readpapers"><span class="header-section-number">2.4</span> Resources and “MUST READ”papers:</h2>
<section id="ebmonfhir-based-tools-and-initiatives-to-support-clinical-research" class="level3" data-number="2.4.1">
<h3 data-number="2.4.1" class="anchored" data-anchor-id="ebmonfhir-based-tools-and-initiatives-to-support-clinical-research"><span class="header-section-number">2.4.1</span> EBMonFHIR-based tools and initiatives to support clinical research</h3>
<ul>
<li><strong>Authors:</strong> Alper B. S.</li>
<li><strong>Journal:</strong> Journal of the American Medical Informatics Association : JAMIA, 30(1), 2022.</li>
<li><strong>DOI/URL:</strong> <a href="https://doi.org/10.1093/jamia/ocac193">10.1093/jamia/ocac193</a></li>
<li><strong>PMC:</strong> <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC9748541/">PMC9748541</a></li>
</ul>
</section>
<section id="hl7-fhir-based-tools-and-initiatives-to-support-clinical-research-a-scoping-review" class="level3" data-number="2.4.2">
<h3 data-number="2.4.2" class="anchored" data-anchor-id="hl7-fhir-based-tools-and-initiatives-to-support-clinical-research-a-scoping-review"><span class="header-section-number">2.4.2</span> HL7 FHIR-based tools and initiatives to support clinical research: a scoping review</h3>
<ul>
<li><strong>Authors:</strong> Duda SN, Kennedy N, Conway D, Cheng AC, Nguyen V, Zayas-Cabán T, Harris PA.</li>
<li><strong>Journal:</strong> J Am Med Inform Assoc, 29(9), 2022.</li>
<li><strong>DOI:</strong> <a href="https://doi.org/10.1093/jamia/ocac105">10.1093/jamia/ocac105</a></li>
<li><strong>PMID:</strong> 35818340; <strong>PMCID:</strong> PMC9382376.</li>
<li><strong>URL:</strong> <a href="https://pubmed.ncbi.nlm.nih.gov/35818340/">PubMed</a></li>
</ul>
</section>
<section id="technology-enabled-clinical-trials-transforming-medical-evidence-generation" class="level3" data-number="2.4.3">
<h3 data-number="2.4.3" class="anchored" data-anchor-id="technology-enabled-clinical-trials-transforming-medical-evidence-generation"><span class="header-section-number">2.4.3</span> Technology-Enabled Clinical Trials: Transforming Medical Evidence Generation</h3>
<ul>
<li><strong>Authors:</strong> Marquis-Gravel G, Roe MT, Turakhia MP, Boden W, Temple R, Sharma A, Hirshberg B, Slater P, Craft N, Stockbridge N, McDowell B, Waldstreicher J, Bourla A, Bansilal S, Wong JL, Meunier C, Kassahun H, Coran P, Bataille L, Patrick-Lake B, Hirsch B, Reites J, Mehta R, Muse ED, Chandross KJ, Silverstein JC, Silcox C, Overhage JM, Califf RM, Peterson ED.</li>
<li><strong>Journal:</strong> Circulation, 140(17), 2019.</li>
<li><strong>DOI:</strong> <a href="https://www.ahajournals.org/doi/10.1161/CIRCULATIONAHA.119.040798">10.1161/CIRCULATIONAHA.119.040798</a></li>
<li><strong>PMID:</strong> 31634011</li>
</ul>
<!-- 
To be added: https://datascience.nih.gov/fhir-initiatives/researchers-training

https://www.healthit.gov/data/data-briefs/electronic-public-health-reporting-among-non-federal-acute-care-hospitals-during

https://www.ncbi.nlm.nih.gov/pmc/articles/PMC9382376/ EBMonFHIR-based tools and initiatives to support clinical research - PMC (nih.gov)

https://www.healthit.gov/sites/default/files/page/2021-04/FHIR%20API%20Fact%20Sheet.pdf

Technology-Enabled Clinical Trials: Transforming Medical Evidence Generation - PubMed (nih.gov) 

https://www.youtube-nocookie.com/embed/UMiPW831b1o
-->
</section>
<section id="for-more-information-on-hl7-cda-and-fhir-standards-and-on-extracting-ehr-data-you-can-visit-the-following-websites" class="level3" data-number="2.4.4">
<h3 data-number="2.4.4" class="anchored" data-anchor-id="for-more-information-on-hl7-cda-and-fhir-standards-and-on-extracting-ehr-data-you-can-visit-the-following-websites"><span class="header-section-number">2.4.4</span> For more information on HL7, CDA, and FHIR standards, and on extracting EHR data, you can visit the following websites:</h3>
<ul>
<li><strong>CDISC:</strong> <a href="https://www.cdisc.org/" class="uri">https://www.cdisc.org/</a></li>
<li><strong>Duke-Margolis International Harmonization of Real World Evidence Standards Dashboard:</strong> <a href="https://healthpolicy.duke.edu/projects/international-harmonization-real-world-evidence-standards-dashboard" class="uri">https://healthpolicy.duke.edu/projects/international-harmonization-real-world-evidence-standards-dashboard</a></li>
<li><strong>HL7:</strong> <a href="http://www.hl7.org" class="uri">http://www.hl7.org</a></li>
<li><strong>FHIR:</strong> <a href="http://hl7.org/fhir/" class="uri">http://hl7.org/fhir/</a></li>
<li><strong>FHIR for Research Workshop (NIH):</strong> <a href="https://datascience.nih.gov/fhir-initiatives/researchers-training" class="uri">https://datascience.nih.gov/fhir-initiatives/researchers-training</a></li>
<li><strong>National Cancer Institute CDE Resource:</strong> <a href="https://cde.nci.nih.gov/" class="uri">https://cde.nci.nih.gov/</a></li>
<li><strong>NIH Common Data Elements:</strong> <a href="https://cde.nlm.nih.gov/home" class="uri">https://cde.nlm.nih.gov/home</a></li>
<li><strong>OAuth 2.0:</strong> <a href="https://oauth.net/2/" class="uri">https://oauth.net/2/</a></li>
<li><strong>OHDSI:</strong> <a href="https://www.ohdsi.org/" class="uri">https://www.ohdsi.org/</a></li>
<li><strong>PCORnet:</strong> <a href="https://pcornet.org/" class="uri">https://pcornet.org/</a></li>
</ul>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>